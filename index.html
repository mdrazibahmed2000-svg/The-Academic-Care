<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Academic Care Fee Portal</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="container">
        <header>
            <h1 id="welcomeHeader" class="text-3xl font-extrabold mb-4 text-center text-indigo-700">The Academic Care</h1>
            <p id="authUserId" class="text-xs text-center text-gray-500 mb-6">Auth User ID: N/A (Anonymous)</p>
        </header>

        <div id="initialView" class="card">
            <h2 class="text-xl">Login</h2>
            <input type="text" id="loginId" placeholder="Enter Student ID or 'admin'">
            <p id="loginError" class="error-message text-red-500 mb-3"></p>
            <button onclick="login()" class="w-full bg-indigo-500 hover:bg-indigo-600 text-white py-2 mb-3">Login</button>
            <button onclick="showRegister()" class="w-full bg-gray-400 hover:bg-gray-500 text-white py-2">Register New Student</button>
        </div>

        <div id="registerView" class="card hidden">
            <h2 class="text-xl">Student Registration</h2>
            <input type="text" id="regName" placeholder="Student Name" required>
            <input type="text" id="regClass" placeholder="Class (e.g., 09, 10)" required>
            <input type="text" id="regRoll" placeholder="Roll No." required>
            <input type="text" id="regGuardianPhone" placeholder="Guardian Phone No." required>
            <p id="registerError" class="error-message text-red-500 mb-3"></p>
            <button onclick="registerStudent()" class="w-full bg-green-500 hover:bg-green-600 text-white py-2 mb-3">Submit Registration</button>
            <button onclick="showLogin()" class="w-full bg-gray-400 hover:bg-gray-500 text-white py-2">Back to Login</button>
        </div>

        <div id="dashboardView" class="hidden">

            <div id="adminPanel" class="hidden">
                <div class="card">
                    <h2 class="text-xl">Fee Management</h2>
                    <select id="studentSelector" onchange="loadMonthlyFees()">
                        <option value="">Select Student...</option>
                    </select>

                    <div id="draftCommButton" class="mt-4 mb-4">
                        </div>

                    <ul id="monthlyFees" class="list-none p-0">
                        </ul>
                </div>

                <div class="card">
                    <div class="collapsible-header" onclick="toggleCollapsible('pendingStudentsContent')">
                        <span>Pending Registrations <span id="pendingCount" class="text-sm">(0)</span></span>
                        <span>&#9662;</span>
                    </div>
                    <div id="pendingStudentsContent" class="collapsible-content">
                        <ul id="pendingStudentsList" class="list-none p-0"></ul>
                    </div>
                </div>

                <div class="card">
                    <div class="collapsible-header" onclick="toggleCollapsible('breakRequestsContent')">
                        <span>Break Requests <span id="breakCount" class="text-sm">(0)</span></span>
                        <span>&#9662;</span>
                    </div>
                    <div id="breakRequestsContent" class="collapsible-content">
                        <div id="breakRequestsList" class="p-2"></div>
                    </div>
                </div>
            </div>
            
            <div id="studentPanel" class="hidden">
                <div class="card">
                    <h2 class="text-xl">My Details</h2>
                    <p class="mb-2"><strong>ID:</strong> <span id="studentIdDisplay"></span></p>
                    <p class="mb-2"><strong>Class:</strong> <span id="studentClass"></span></p>
                    <p class="mb-2"><strong>Status:</strong> <span id="studentStatus" class="font-bold text-green-600"></span></p>
                </div>
                
                <div class="card">
                    <h2 class="text-xl">Monthly Fee Status</h2>
                    <ul id="feeStatusList" class="list-none p-0">
                        </ul>
                    <div id="breakRequestArea">
                        </div>
                </div>
                
                <div class="card">
                    <h2 class="text-xl">Ask Assistant (AI)</h2>
                    <textarea id="geminiQuery" rows="2" placeholder="Ask about fees, deadlines, or break policy..."></textarea>
                    <button onclick="handleStudentQuery()" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 mb-2">Ask Question</button>
                    <div id="geminiLoader" class="text-center hidden"><img src="loading.gif" alt="Loading..." style="width: 20px; display: inline-block;"> Thinking...</div>
                    <div id="geminiResponse" class="mt-3 p-3 bg-gray-100 rounded text-sm"></div>
                </div>
            </div>

            <div class="mt-6 text-center">
                <button onclick="logout()" class="bg-red-500 hover:bg-red-600 text-white py-2 px-6">Logout</button>
            </div>
        </div>
    </div>
    
    <div id="communicationModal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 class="text-xl">Drafted Fee Communication</h2>
            <textarea id="draftedCommunication" rows="6" class="w-full p-2 border rounded" readonly></textarea>
            <div id="communicationLoader" class="text-center hidden mt-2">Drafting...</div>
            <div class="flex justify-between mt-3">
                <button onclick="copyToClipboard('draftedCommunication')" class="bg-green-500 hover:bg-green-600 text-white py-2 text-sm">Copy Message</button>
                <button onclick="closeModal()" class="bg-gray-400 hover:bg-gray-500 text-white py-2 text-sm">Close</button>
            </div>
        </div>
    </div>

    <script type="module" src="script.js"></script>

</body>
</html>
